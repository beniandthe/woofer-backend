<!doctype html>
<html>
{% load woofer_extras %}
<p style="margin-top: 10px;">
    <small>
        We sometimes boost pets who may be overlooked or have waited longer, so every pet gets a fair chance to be seen.
    </small>
</p>

{% if request.GET.msg == "liked" %}
<p><strong>Liked.</strong> We’ll notify the organization.</p>

{% elif request.GET.msg == "already_liked" %}
<p><strong>Already liked.</strong></p>
{% endif %}

<h1>Woofer</h1>
<p>
    Browse adoptable pets from local rescues.
    When you like a pet, we’ll notify the organization.
    Applying does not guarantee adoption — rescues follow up directly.
</p>

<h2>Pets Feed</h2>

{% if api_result.ok %}
  {% with items=api_result.data.items %}
    {% if items %}
      <ul>
        {% for pet in items %}
          <li style="margin-bottom: 16px; padding: 12px; border: 1px solid #333; border-radius: 10px;">
            <strong>{{ pet.name }}</strong>
            {% if pet.organization %}
              — <em>{{ pet.organization.name }}</em>

              {% if pet.pet_id in liked_ids %}
                <div style="margin-top: 6px;">
                  <small><strong>Liked ✓</strong></small>
                </div>
              {% else %}
                <div style="display:flex; gap:8px; margin-top:8px;">
                    <form method="post" action="{% url 'like_pet' pet.pet_id %}">
                        {% csrf_token %}
                        <button type="submit">Like</button>
                    </form>
                    {% endif %}

                    <form method="post" action="/pets/{{ pet.pet_id }}/apply/">
                        {% csrf_token %}
                        <button type="submit">Apply</button>
                    </form>

                </div>
            {% endif %}

            {% if pet.why_shown %}
              <div style="margin-top: 8px; opacity: 0.9;">
                <small><strong>Why you’re seeing this:</strong></small>

                <div style="margin-top: 6px;">
                  {% for reason in pet.why_shown %}
                    {% with info=why_shown_copy|get_item:reason %}
                      <span style="display:inline-block; padding:2px 8px; margin:2px; border:1px solid #999; border-radius:999px;">
                        {{ info.label|default:reason }}
                      </span>
                    {% endwith %}
                  {% endfor %}
                </div>

                <div style="margin-top: 6px;">
                  {% for reason in pet.why_shown %}
                    {% with info=why_shown_copy|get_item:reason %}
                      <div style="margin: 2px 0;">
                        <small>{{ info.blurb|default:"" }}</small>
                      </div>
                    {% endwith %}
                  {% endfor %}
                </div>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p><strong>No pets available right now.</strong></p>
      <p><small>Try increasing distance or check back later.</small></p>
    {% endif %}
  {% endwith %}
{% else %}
  <p>API returned ok=false</p>
{% endif %}
